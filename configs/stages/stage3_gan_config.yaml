# Stage 3: GAN Fine-tuning (Epochs 150-169)
# GAN training for perceptual quality - Major improvements (LPIPS: 0.0695)

# Project settings
project:
  name: "face-sr-stage3-gan"
  seed: 42
  device: "cuda"

# Data settings
data:
  data_root: "./data/processed/"
  hr_size: 256
  lr_size: 64
  scale_factor: 4
  batch_size: 48
  num_workers: 16
  pin_memory: true

# Augmentation settings
augmentation:
  horizontal_flip: 0.5
  random_rotate90: 0.0
  random_crop:
    hr_patch_size: 256
    lr_patch_size: 64

# Model settings
model:
  type: "custom"

  custom:
    num_channels: 64
    num_groups: 6
    blocks_per_group: 10
    reduction_ratio: 4
    upscale_factor: 4

# Loss settings - Stage 3: GAN fine-tuning for perceptual quality
loss:
  l1_weight: 0.01  # Reduced L1, focus on perceptual
  perceptual_weight: 1.0
  ssim_weight: 0.0

  use_charbonnier: false
  charbonnier_eps: 1.0e-3

  perceptual:
    layers: ["conv3_4"]
    normalize: true

  gan:
    weight: 0.005  # GAN enabled
    type: "vanilla"
    d_lr: 0.0001
    d_weight_decay: 0.0
    d_updates_per_g: 1
    start_epoch: 0  # GAN active from start of this stage
    d_channels: 64
    d_use_bn: true

# Training settings
training:
  epochs: 20
  optimizer:
    type: "adam"
    lr: 0.0001
    weight_decay: 0.0
    betas: [0.9, 0.999]

  scheduler:
    type: "step"
    step_size: 1000
    gamma: 1.0

  gradient_clip: 0.5
  accumulation_steps: 1
  mixed_precision: false

  early_stopping:
    patience: 30
    metric: "val_loss"
    mode: "min"

# Checkpointing
checkpoint:
  save_dir: "./checkpoints"
  save_every: 2
  save_best: true
  resume: "checkpoints/epoch_150.pth"  # Resume from Stage 2

# Logging
logging:
  wandb:
    enabled: false
    project: "face-super-resolution"
    entity: null
    log_every: 100
    log_images_every: 5

  console:
    log_every: 10

# Evaluation settings
evaluation:
  metrics: ["psnr", "ssim"]
  test_batch_size: 1
